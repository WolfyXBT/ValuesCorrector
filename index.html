<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>价值观纠正器</title>
    
    <!-- Favicon 完整支持 -->
    <link rel="apple-touch-icon" sizes="180x180" href="favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon/favicon-16x16.png">
    <link rel="manifest" href="favicon/site.webmanifest">
    <link rel="icon" type="image/x-icon" href="favicon/favicon.ico">
    <link rel="shortcut icon" type="image/x-icon" href="favicon/favicon.ico">
    <meta name="theme-color" content="#667eea">
    
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-XEZ049M5R2"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-XEZ049M5R2');
    </script>
    
    <style>
        body {
            font-family: 'PingFang SC', 'Microsoft YaHei', 'Helvetica Neue', sans-serif;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .container {
            padding: 50px 50px 30px 50px;
            text-align: center;
            transform: scale(1.3);
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .field {
            margin: 20px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        
        select {
            padding: 15px 45px 15px 20px;
            font-size: 16px;
            border: 2px solid #e1e8ff;
            border-radius: 12px;
            background: linear-gradient(145deg, #ffffff, #f0f4ff);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            cursor: pointer;
            min-width: 140px;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23667eea' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e");
            background-size: 16px 16px;
            background-position: calc(100% - 15px) center;
            background-repeat: no-repeat;
        }
        
        select:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.15);
        }
        
        select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        select option {
            padding: 12px 20px;
            background: rgba(255, 255, 255, 0.95);
            color: #333;
            font-size: 16px;
            border: none;
            margin: 2px 0;
        }
        
        select option:hover {
            background: linear-gradient(145deg, #667eea, #764ba2);
            color: white;
        }
        
        select option:checked {
            background: linear-gradient(145deg, #667eea, #764ba2);
            color: white;
            font-weight: 600;
        }
        
        select optgroup {
            font-weight: bold;
            font-size: 14px;
            color: #667eea;
            background: #f0f4ff;
            padding: 8px 12px;
            margin: 4px 0;
        }
        
        input {
            width: 220px;
            padding: 15px 20px;
            font-size: 16px;
            border: 2px solid #e1e8ff;
            border-radius: 12px;
            background: linear-gradient(145deg, #ffffff, #f9fbff);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            text-align: right;
            font-weight: 500;
        }
        
        input:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.15);
        }
        
        input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        input::placeholder {
            color: #a0a0a0;
            font-weight: normal;
        }
        
        h1 {
            font-size: 2.8em;
            margin-bottom: 35px;
            margin-top: -5px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 600;
            letter-spacing: -0.5px;
        }
        
        .author {
            font-size: 0.8em;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            font-weight: 500;
            display: block;
            opacity: 0.8;
        }
        
        .author svg {
            transition: all 0.3s ease;
            fill: url(#gradient);
        }
        
        .author:hover {
            transform: translateY(-2px);
            opacity: 1;
            filter: drop-shadow(0 4px 10px rgba(102, 126, 234, 0.3));
        }
        
        .author:hover svg {
            fill: url(#gradientHover);
        }
        
        .social-links {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-top: 35px;
            margin-bottom: 0px;
        }
        
        /* 加号按钮样式 */
        .add-btn {
            background: none !important;
            border: none !important;
            padding: 0 !important;
            cursor: pointer;
            font-size: 0.8em;
            transition: all 0.3s ease;
            text-decoration: none;
            font-weight: 500;
            display: block;
            opacity: 0.8;
        }
        
        .add-btn svg {
            transition: all 0.3s ease;
            fill: url(#gradient);
        }
        
        .add-btn:hover {
            transform: translateY(-2px);
            opacity: 1;
            filter: drop-shadow(0 4px 10px rgba(102, 126, 234, 0.3));
        }
        
        .add-btn:hover svg {
            fill: url(#gradientHover);
        }
        
        /* 模态框样式 */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            margin: 5% auto;
            padding: 0;
            border-radius: 20px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .emoji-modal-content {
            max-width: 500px;
        }
        
        .modal-header {
            padding: 20px 25px;
            border-bottom: 1px solid #e1e8ff;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 20px 20px 0 0;
        }
        
        .modal-header h2, .modal-header h3 {
            margin: 0;
            font-size: 1.5em;
            font-weight: 600;
        }
        
        .close {
            color: white;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            line-height: 1;
        }
        
        .close:hover {
            opacity: 0.7;
        }
        
        .modal-body {
            padding: 25px;
        }
        
        /* 表单样式 */
        .add-form, .custom-list {
            margin-bottom: 25px;
        }
        
        .add-form h3, .custom-list h3 {
            color: #667eea;
            font-size: 1.2em;
            margin-bottom: 15px;
            font-weight: 600;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: 500;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 10px 15px;
            border: 2px solid #e1e8ff;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
            box-sizing: border-box;
        }
        
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .price-input {
            display: flex;
            gap: 10px;
        }
        
        #customEmoji {
            cursor: pointer;
        }
        
        #customEmoji:hover {
            border-color: #667eea;
        }
        
        .price-input input {
            flex: 2;
        }
        
        .price-input select {
            flex: 1;
        }
        
        .form-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .btn-primary, .btn-secondary {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background: linear-gradient(145deg, #667eea, #764ba2);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        .btn-secondary {
            background: #f5f5f5;
            color: #666;
        }
        
        .btn-secondary:hover {
            background: #e0e0e0;
        }
        
        /* 项目列表样式 */
        .items-list {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .custom-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 15px;
            margin-bottom: 8px;
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid #e1e8ff;
            border-radius: 10px;
            transition: all 0.3s ease;
        }
        
        .custom-item:hover {
            background: rgba(102, 126, 234, 0.05);
            border-color: #667eea;
        }
        
        .item-info {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
        }
        
        .item-emoji {
            font-size: 20px;
        }
        
        .item-details {
            flex: 1;
        }
        
        .item-name {
            font-weight: 600;
            color: #333;
        }
        
        .item-price {
            font-size: 12px;
            color: #666;
        }
        
        .item-actions {
            display: flex;
            gap: 5px;
        }
        
        .item-btn {
            padding: 5px 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }
        
        .edit-btn {
            background: #ffa726;
            color: white;
        }
        
        .edit-btn:hover {
            background: #ff9800;
        }
        
        .delete-btn {
            background: #ef5350;
            color: white;
        }
        
        .delete-btn:hover {
            background: #f44336;
        }
        
        /* Emoji选择器样式 */
        .emoji-categories {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
            justify-content: center;
        }
        
        .emoji-category {
            padding: 8px 12px;
            border: 2px solid #e1e8ff;
            border-radius: 20px;
            background: white;
            color: #667eea;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }
        
        .emoji-category.active, .emoji-category:hover {
            background: linear-gradient(145deg, #667eea, #764ba2);
            color: white;
            border-color: #667eea;
        }
        
        .emoji-grid {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 8px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .emoji-item {
            padding: 10px;
            text-align: center;
            font-size: 20px;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .emoji-item:hover {
            background: rgba(102, 126, 234, 0.1);
            transform: scale(1.1);
        }
        
        /* Toast 提示样式 */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(145deg, #667eea, #764ba2);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 10000;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease;
            font-size: 14px;
            font-weight: 500;
            max-width: 300px;
            word-wrap: break-word;
        }
        
        .toast.show {
            opacity: 1;
            transform: translateX(0);
        }
        
        /* 移动端响应式设计 */
        @media screen and (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .container {
                padding: 30px 20px 20px 20px;
                transform: scale(1);
                margin: 10px;
                border-radius: 15px;
            }
            
            h1 {
                font-size: 2.2em;
                margin-bottom: 15px;
                margin-top: 5px;
            }
            
            .author {
                font-size: 0.7em;
            }
            
            .social-links {
                margin-top: 30px;
                margin-bottom: 0px;
                gap: 15px;
            }
            
            .field {
                margin: 15px 0;
                flex-direction: row;
                align-items: center;
                gap: 12px;
            }
            
            select {
                min-width: 130px;
                width: 40%;
                padding: 10px 35px 10px 12px;
                font-size: 13px;
                margin-bottom: 0;
            }
            
            input {
                width: 55%;
                padding: 10px 12px;
                font-size: 16px;
                text-align: right;
            }
            
            /* 移动端模态框样式 */
            .modal-content {
                width: 95%;
                margin: 10% auto;
                max-height: 85vh;
            }
            
            .emoji-grid {
                grid-template-columns: repeat(6, 1fr);
            }
            
            .emoji-categories {
                gap: 5px;
            }
            
            .emoji-category {
                padding: 6px 10px;
                font-size: 11px;
            }
            
            /* 移动端toast样式 */
            .toast {
                top: 10px;
                right: 10px;
                left: 10px;
                max-width: none;
                font-size: 13px;
            }
        }
        
        @media screen and (max-width: 480px) {
            .container {
                padding: 20px 15px 20px 15px;
                margin: 5px;
            }
            
            h1 {
                font-size: 1.8em;
                margin-bottom: 12px;
            }
            
            .author {
                font-size: 0.6em;
            }
            
            .social-links {
                margin-top: 20px;
                margin-bottom: 0px;
                gap: 12px;
            }
            
            .field {
                margin: 10px 0;
                gap: 8px;
            }
            
            select {
                min-width: 110px;
                width: 50%;
                padding: 8px 30px 8px 10px;
                font-size: 12px;
            }
            
            input {
                width: 46%;
                padding: 8px 10px;
                font-size: 16px;
                text-align: right;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>价值观纠正器</h1>
        
        <div class="field">
        <select id="currency1">
            <optgroup label="加密货币">
                <option value="BTC" selected>🟠 BTC</option>
                <option value="ETH">♦️ ETH</option>
                <option value="SOL">🟣 SOL</option>
                <option value="BNB">🟡 BNB</option>
                <option value="OKB">⚫ OKB</option>
            </optgroup>
            <optgroup label="法币">
                <option value="USD">🇺🇸 USD</option>
                <option value="CNY">🇨🇳 CNY</option>
                <option value="JPY">🇯🇵 JPY</option>
                <option value="KRW">🇰🇷 KRW</option>
                <option value="SGD">🇸🇬 SGD</option>
                <option value="AED">🇦🇪 AED</option>
                <option value="HKD">🇭🇰 HKD</option>
                <option value="MYR">🇲🇾 MYR</option>
            </optgroup>
            <optgroup label="实物">
                <option value="ZHUJIAO">🍚 猪脚饭</option>
                <option value="KFC">🍗 KFC</option>
                <option value="IN11">💃 in11嫩模</option>
                <option value="IPHONE17">📱 iPhone17</option>
                <option value="MACBOOK">💻 MacBook Air</option>
                <option value="ROLEX">⌚ Rolex</option>
                <option value="XIAOMISU7">🏎️ Xiaomi Su7</option>
                <option value="PORSCHE">🏎️ Porsche 718</option>
                <option value="FERRARI">🏎️ Ferrari Roma</option>
            </optgroup>
        </select>
        <input type="text" id="amount1" placeholder="输入金额">
    </div>
    
    <div class="field">
        <select id="currency2">
            <optgroup label="加密货币">
                <option value="BTC">🟠 BTC</option>
                <option value="ETH" selected>♦️ ETH</option>
                <option value="SOL">🟣 SOL</option>
                <option value="BNB">🟡 BNB</option>
                <option value="OKB">⚫ OKB</option>
            </optgroup>
            <optgroup label="法币">
                <option value="USD">🇺🇸 USD</option>
                <option value="CNY">🇨🇳 CNY</option>
                <option value="JPY">🇯🇵 JPY</option>
                <option value="KRW">🇰🇷 KRW</option>
                <option value="SGD">🇸🇬 SGD</option>
                <option value="AED">🇦🇪 AED</option>
                <option value="HKD">🇭🇰 HKD</option>
                <option value="MYR">🇲🇾 MYR</option>
            </optgroup>
            <optgroup label="实物">
                <option value="ZHUJIAO">🍚 猪脚饭</option>
                <option value="KFC">🍗 KFC</option>
                <option value="IN11">💃 in11嫩模</option>
                <option value="IPHONE17">📱 iPhone17</option>
                <option value="MACBOOK">💻 MacBook Air</option>
                <option value="ROLEX">⌚ Rolex</option>
                <option value="XIAOMISU7">🏎️ Xiaomi Su7</option>
                <option value="PORSCHE">🏎️ Porsche 718</option>
                <option value="FERRARI">🏎️ Ferrari Roma</option>
            </optgroup>
        </select>
        <input type="text" id="amount2" placeholder="输入金额">
    </div>
    
    <div class="field">
        <select id="currency3">
            <optgroup label="加密货币">
                <option value="BTC">🟠 BTC</option>
                <option value="ETH">♦️ ETH</option>
                <option value="SOL" selected>🟣 SOL</option>
                <option value="BNB">🟡 BNB</option>
                <option value="OKB">⚫ OKB</option>
            </optgroup>
            <optgroup label="法币">
                <option value="USD">🇺🇸 USD</option>
                <option value="CNY">🇨🇳 CNY</option>
                <option value="JPY">🇯🇵 JPY</option>
                <option value="KRW">🇰🇷 KRW</option>
                <option value="SGD">🇸🇬 SGD</option>
                <option value="AED">🇦🇪 AED</option>
                <option value="HKD">🇭🇰 HKD</option>
                <option value="MYR">🇲🇾 MYR</option>
            </optgroup>
            <optgroup label="实物">
                <option value="ZHUJIAO">🍚 猪脚饭</option>
                <option value="KFC">🍗 KFC</option>
                <option value="IN11">💃 in11嫩模</option>
                <option value="IPHONE17">📱 iPhone17</option>
                <option value="MACBOOK">💻 MacBook Air</option>
                <option value="ROLEX">⌚ Rolex</option>
                <option value="XIAOMISU7">🏎️ Xiaomi Su7</option>
                <option value="PORSCHE">🏎️ Porsche 718</option>
                <option value="FERRARI">🏎️ Ferrari Roma</option>
            </optgroup>
        </select>
        <input type="text" id="amount3" placeholder="输入金额">
    </div>
    
    <div class="field">
        <select id="currency4">
            <optgroup label="加密货币">
                <option value="BTC">🟠 BTC</option>
                <option value="ETH">♦️ ETH</option>
                <option value="SOL">🟣 SOL</option>
                <option value="BNB">🟡 BNB</option>
                <option value="OKB">⚫ OKB</option>
            </optgroup>
            <optgroup label="法币">
                <option value="USD" selected>🇺🇸 USD</option>
                <option value="CNY">🇨🇳 CNY</option>
                <option value="JPY">🇯🇵 JPY</option>
                <option value="KRW">🇰🇷 KRW</option>
                <option value="SGD">🇸🇬 SGD</option>
                <option value="AED">🇦🇪 AED</option>
                <option value="HKD">🇭🇰 HKD</option>
                <option value="MYR">🇲🇾 MYR</option>
            </optgroup>
            <optgroup label="实物">
                <option value="ZHUJIAO">🍚 猪脚饭</option>
                <option value="KFC">🍗 KFC</option>
                <option value="IN11">💃 in11嫩模</option>
                <option value="IPHONE17">📱 iPhone17</option>
                <option value="MACBOOK">💻 MacBook Air</option>
                <option value="ROLEX">⌚ Rolex</option>
                <option value="XIAOMISU7">🏎️ Xiaomi Su7</option>
                <option value="PORSCHE">🏎️ Porsche 718</option>
                <option value="FERRARI">🏎️ Ferrari Roma</option>
            </optgroup>
        </select>
        <input type="text" id="amount4" placeholder="输入金额">
    </div>
    
    <div class="field">
        <select id="currency5">
            <optgroup label="加密货币">
                <option value="BTC">🟠 BTC</option>
                <option value="ETH">♦️ ETH</option>
                <option value="SOL">🟣 SOL</option>
                <option value="BNB">🟡 BNB</option>
                <option value="OKB">⚫ OKB</option>
            </optgroup>
            <optgroup label="法币">
                <option value="USD">🇺🇸 USD</option>
                <option value="CNY" selected>🇨🇳 CNY</option>
                <option value="JPY">🇯🇵 JPY</option>
                <option value="KRW">🇰🇷 KRW</option>
                <option value="SGD">🇸🇬 SGD</option>
                <option value="AED">🇦🇪 AED</option>
                <option value="HKD">🇭🇰 HKD</option>
                <option value="MYR">🇲🇾 MYR</option>
            </optgroup>
            <optgroup label="实物">
                <option value="ZHUJIAO">🍚 猪脚饭</option>
                <option value="KFC">🍗 KFC</option>
                <option value="IN11">💃 in11嫩模</option>
                <option value="IPHONE17">📱 iPhone17</option>
                <option value="MACBOOK">💻 MacBook Air</option>
                <option value="ROLEX">⌚ Rolex</option>
                <option value="XIAOMISU7">🏎️ Xiaomi Su7</option>
                <option value="PORSCHE">🏎️ Porsche 718</option>
                <option value="FERRARI">🏎️ Ferrari Roma</option>
            </optgroup>
        </select>
        <input type="text" id="amount5" placeholder="输入金额">
    </div>
    
    <div class="field">
        <select id="currency6">
            <optgroup label="加密货币">
                <option value="BTC">🟠 BTC</option>
                <option value="ETH">♦️ ETH</option>
                <option value="SOL">🟣 SOL</option>
                <option value="BNB">🟡 BNB</option>
                <option value="OKB">⚫ OKB</option>
            </optgroup>
            <optgroup label="法币">
                <option value="USD">🇺🇸 USD</option>
                <option value="CNY">🇨🇳 CNY</option>
                <option value="JPY">🇯🇵 JPY</option>
                <option value="KRW">🇰🇷 KRW</option>
                <option value="SGD">🇸🇬 SGD</option>
                <option value="AED">🇦🇪 AED</option>
                <option value="HKD" selected>🇭🇰 HKD</option>
                <option value="MYR">🇲🇾 MYR</option>
            </optgroup>
            <optgroup label="实物">
                <option value="ZHUJIAO">🍚 猪脚饭</option>
                <option value="KFC">🍗 KFC</option>
                <option value="IN11">💃 in11嫩模</option>
                <option value="IPHONE17">📱 iPhone17</option>
                <option value="MACBOOK">💻 MacBook Air</option>
                <option value="ROLEX">⌚ Rolex</option>
                <option value="XIAOMISU7">🏎️ Xiaomi Su7</option>
                <option value="PORSCHE">🏎️ Porsche 718</option>
                <option value="FERRARI">🏎️ Ferrari Roma</option>
            </optgroup>
        </select>
        <input type="text" id="amount6" placeholder="输入金额">
    </div>
    
    <div class="social-links">
        <svg width="0" height="0" style="position: absolute;">
            <defs>
                <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" stop-color="#667eea"/>
                    <stop offset="100%" stop-color="#764ba2"/>
                </linearGradient>
                <linearGradient id="gradientHover" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" stop-color="#764ba2"/>
                    <stop offset="100%" stop-color="#667eea"/>
                </linearGradient>
            </defs>
        </svg>
        
        <button id="manageCustomBtn" class="author add-btn" title="管理自定义项目">
            <svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11h-4v4h-2v-4H7v-2h4V7h2v4h4v2z"/>
            </svg>
        </button>
        <a href="https://x.com/Wolfy_XBT" target="_blank" class="author">
            <svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
            </svg>
        </a>
        <a href="https://github.com/WolfyXBT/ValuesCorrector" target="_blank" class="author">
            <svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.30.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
            </svg>
        </a>
    </div>

    <!-- 自定义项目管理模态框 -->
    <div id="customModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>管理自定义项目</h2>
                <span class="close">&times;</span>
            </div>
            
            <div class="modal-body">
                <!-- 添加新项目表单 -->
                <div class="add-form">
                    <h3>添加新项目</h3>
                    <div class="form-group">
                        <label>项目名称:</label>
                        <input type="text" id="customName" placeholder="输入项目名称" maxlength="20">
                    </div>
                    
                    <div class="form-group">
                        <label>选择表情:</label>
                        <input type="text" id="customEmoji" placeholder="点击这里选择表情" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label>基准价格:</label>
                        <div class="price-input">
                            <input type="number" id="customPrice" placeholder="0.00" min="0" step="0.01">
                            <select id="customBaseCurrency">
                                <option value="USD">🇺🇸 USD</option>
                                <option value="CNY" selected>🇨🇳 CNY</option>
                                <option value="JPY">🇯🇵 JPY</option>
                                <option value="EUR">🇪🇺 EUR</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" id="addCustomBtn" class="btn-primary">添加项目</button>
                        <button type="button" id="cancelEditBtn" class="btn-secondary" style="display: none;">取消编辑</button>
                    </div>
                </div>
                
                <!-- 已有项目列表 -->
                <div class="custom-list">
                    <h3>已有项目</h3>
                    <div id="customItemsList" class="items-list">
                        <!-- 动态生成的项目列表 -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Emoji选择器模态框 -->
    <div id="emojiModal" class="modal">
        <div class="modal-content emoji-modal-content">
            <div class="modal-header">
                <h3>选择表情</h3>
                <span class="close emoji-close">&times;</span>
            </div>
            <div class="modal-body">
                <div class="emoji-categories">
                    <button class="emoji-category active" data-category="food">🍔 食物</button>
                    <button class="emoji-category" data-category="electronics">📱 电子</button>
                    <button class="emoji-category" data-category="transport">🚗 交通</button>
                    <button class="emoji-category" data-category="lifestyle">👕 生活</button>
                    <button class="emoji-category" data-category="sports">⚽ 运动</button>
                    <button class="emoji-category" data-category="symbols">💰 符号</button>
                </div>
                <div class="emoji-grid" id="emojiGrid">
                    <!-- 动态生成的emoji列表 -->
                </div>
            </div>
        </div>
    </div>

    <script>
        let rates = {};
        let updating = false;
        let lastInputField = 1; // 记录最后一次输入数字的栏位
        let customItems = {}; // 自定义项目存储
        let currentEditingItem = null; // 当前编辑的项目
        
        // Emoji分类数据
        const emojiCategories = {
            food: ['🍔', '🍕', '🍟', '🌮', '🥗', '🍜', '🍲', '🥘', '🍱', '🍙', '🍘', '🍚', '🍛', '🍤', '🍗', '🥓', '🥩', '🍖', '🌭', '🥪', '🧋', '☕', '🥤', '🍺', '🍻', '🥂', '🍷', '🍸', '🍹', '🧊', '🍰', '🎂', '🧁', '🍮', '🍭', '🍬', '🍫', '🍿', '🍩', '🍪'],
            electronics: ['📱', '💻', '⌚', '🖥️', '⌨️', '🖱️', '🖨️', '📷', '📹', '📺', '📻', '🎮', '🕹️', '💾', '💿', '📀', '🔌', '🔋', '💡', '🔦', '📡', '📞', '☎️', '📟', '📠', '💯', '🔍', '🔎', '📊', '📈', '📉', '💰', '💳', '💎', '⚡'],
            transport: ['🚗', '🚙', '🚐', '🚛', '🚚', '🚨', '🚔', '🚍', '🚌', '🚎', '🏎️', '🚓', '🚑', '🚒', '🚕', '🛻', '🚜', '🏍️', '🛵', '🚲', '🛴', '✈️', '🛫', '🛬', '🚁', '🚀', '🛸', '🚢', '⛵', '🚤', '🛥️', '⛴️', '🚂', '🚃', '🚄', '🚅', '🚆', '🚇', '🚈', '🚉'],
            lifestyle: ['👕', '👖', '👗', '👔', '🧥', '👚', '👘', '🥻', '👙', '🩱', '👠', '👡', '👢', '👞', '👟', '🥿', '🧦', '🧤', '🎒', '👜', '👛', '💼', '🧳', '👑', '👒', '🎩', '🧢', '⛑️', '💄', '💍', '💎', '🔑', '🕶️', '👓', '🥽', '⌚', '📿', '💻', '📱', '🏠', '🏡'],
            sports: ['⚽', '🏀', '🏈', '⚾', '🥎', '🎾', '🏐', '🏉', '🥏', '🎱', '🪀', '🏓', '🏸', '🏒', '🏑', '🥍', '🏏', '🪃', '🥊', '🥋', '🎽', '🛹', '🛷', '⛸️', '🥌', '🎿', '⛷️', '🏂', '🪂', '🏋️', '🤸', '🤾', '⛹️', '🤺', '🤼', '🧘', '🏃', '🚴', '🏊', '🏄'],
            symbols: ['💰', '💵', '💴', '💶', '💷', '🪙', '💳', '💎', '⚖️', '🏆', '🥇', '🥈', '🥉', '🏅', '🎖️', '📊', '📈', '📉', '💹', '💲', '🔢', '🧮', '⭐', '🌟', '⚡', '🔥', '💯', '✨', '🎯', '🎪', '🎭', '🎨', '🎬', '🎵', '🎶', '🎤', '🎧', '🎼', '🎹', '🥁']
        };
        
        // 初始化Emoji选择器
        function initEmojiPicker() {
            const emojiGrid = document.getElementById('emojiGrid');
            const categoryButtons = document.querySelectorAll('.emoji-category');
            
            // 默认显示食物分类
            showEmojiCategory('food');
            
            // 分类按钮事件
            categoryButtons.forEach(button => {
                button.addEventListener('click', () => {
                    categoryButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    showEmojiCategory(button.dataset.category);
                });
            });
        }
        
        // 显示指定分类的emoji
        function showEmojiCategory(category) {
            const emojiGrid = document.getElementById('emojiGrid');
            const emojis = emojiCategories[category] || [];
            
            emojiGrid.innerHTML = '';
            emojis.forEach(emoji => {
                const emojiItem = document.createElement('div');
                emojiItem.className = 'emoji-item';
                emojiItem.textContent = emoji;
                emojiItem.addEventListener('click', () => selectEmoji(emoji));
                emojiGrid.appendChild(emojiItem);
            });
        }
        
        // 选择emoji
        function selectEmoji(emoji) {
            document.getElementById('customEmoji').value = emoji;
            closeEmojiModal();
        }
        
        // 打开emoji选择器
        function openEmojiModal() {
            document.getElementById('emojiModal').style.display = 'block';
        }
        
        // 关闭emoji选择器
        function closeEmojiModal() {
            document.getElementById('emojiModal').style.display = 'none';
        }
        
        // Toast 提示功能
        function showToast(message) {
            // 移除已存在的toast
            const existingToast = document.querySelector('.toast');
            if (existingToast) {
                existingToast.remove();
            }
            
            // 创建新的toast
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            document.body.appendChild(toast);
            
            // 显示动画
            setTimeout(() => {
                toast.classList.add('show');
            }, 100);
            
            // 3秒后自动消失
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.remove();
                    }
                }, 300);
            }, 3000);
        }
        
        // 自定义项目管理功能
        function loadCustomItems() {
            const saved = localStorage.getItem('customItems');
            if (saved) {
                try {
                    customItems = JSON.parse(saved);
                } catch (error) {
                    console.error('加载自定义项目失败:', error);
                    customItems = {};
                }
            }
            renderCustomItemsList();
        }
        
        function saveCustomItems() {
            localStorage.setItem('customItems', JSON.stringify(customItems));
        }
        
        function generateCustomId() {
            const ids = Object.keys(customItems).map(id => parseInt(id.replace('CUSTOM_', ''))).filter(num => !isNaN(num));
            const maxId = ids.length > 0 ? Math.max(...ids) : 0;
            return `CUSTOM_${String(maxId + 1).padStart(3, '0')}`;
        }
        
        function addCustomItem() {
            const name = document.getElementById('customName').value.trim();
            const emoji = document.getElementById('customEmoji').value.trim();
            const price = parseFloat(document.getElementById('customPrice').value);
            const baseCurrency = document.getElementById('customBaseCurrency').value;
            
            // 验证输入
            if (!name) {
                showToast('请输入项目名称');
                return;
            }
            if (!emoji) {
                showToast('请选择表情');
                return;
            }
            if (!price || price <= 0) {
                showToast('请输入有效的价格');
                return;
            }
            
            // 检查重复名称
            const existingNames = Object.values(customItems).map(item => item.name.toLowerCase());
            if (!currentEditingItem && existingNames.includes(name.toLowerCase())) {
                showToast('项目名称已存在，请使用其他名称');
                return;
            }
            
            let itemId;
            if (currentEditingItem) {
                itemId = currentEditingItem;
            } else {
                itemId = generateCustomId();
            }
            
            customItems[itemId] = {
                name: name,
                emoji: emoji,
                basePrice: price,
                baseCurrency: baseCurrency
            };
            
            saveCustomItems();
            renderCustomItemsList();
            updateAllSelectOptions();
            
            // 重新加载汇率以包含新的自定义项目
            loadRates().then(() => {
                // 如果有输入数据，重新计算汇率
                const hasData = Array.from({length: 6}, (_, i) => i + 1).some(i => 
                    document.getElementById(`amount${i}`).value.trim() !== ''
                );
                if (hasData) {
                    convert(lastInputField);
                }
            });
            
            clearForm();
            
            if (currentEditingItem) {
                showToast(`${customItems[currentEditingItem].emoji} ${customItems[currentEditingItem].name} 已更新`);
                currentEditingItem = null;
                document.getElementById('addCustomBtn').textContent = '添加项目';
                document.getElementById('cancelEditBtn').style.display = 'none';
            } else {
                showToast(`${customItems[itemId].emoji} ${customItems[itemId].name} 已添加`);
            }
        }
        
        function editCustomItem(itemId) {
            const item = customItems[itemId];
            if (!item) return;
            
            document.getElementById('customName').value = item.name;
            document.getElementById('customEmoji').value = item.emoji;
            document.getElementById('customPrice').value = item.basePrice;
            document.getElementById('customBaseCurrency').value = item.baseCurrency;
            
            currentEditingItem = itemId;
            document.getElementById('addCustomBtn').textContent = '更新项目';
            document.getElementById('cancelEditBtn').style.display = 'inline-block';
        }
        
        function deleteCustomItem(itemId) {
            const item = customItems[itemId];
            if (!item) return;
            
            if (confirm(`确定要删除 "${item.emoji} ${item.name}" 吗？`)) {
                delete customItems[itemId];
                saveCustomItems();
                renderCustomItemsList();
                updateAllSelectOptions();
                
                // 重新加载汇率以移除删除的自定义项目
                loadRates().then(() => {
                    // 如果有输入数据，重新计算汇率
                    const hasData = Array.from({length: 6}, (_, i) => i + 1).some(i => 
                        document.getElementById(`amount${i}`).value.trim() !== ''
                    );
                    if (hasData) {
                        convert(lastInputField);
                    }
                });
                
                showToast(`${item.emoji} ${item.name} 已删除`);
            }
        }
        
        function cancelEdit() {
            clearForm();
            currentEditingItem = null;
            document.getElementById('addCustomBtn').textContent = '添加项目';
            document.getElementById('cancelEditBtn').style.display = 'none';
        }
        
        function clearForm() {
            document.getElementById('customName').value = '';
            document.getElementById('customEmoji').value = '';
            document.getElementById('customPrice').value = '';
            document.getElementById('customBaseCurrency').value = 'CNY';
        }
        
        function renderCustomItemsList() {
            const container = document.getElementById('customItemsList');
            
            if (Object.keys(customItems).length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #999; padding: 20px;">暂无自定义项目</p>';
                return;
            }
            
            container.innerHTML = '';
            Object.keys(customItems).forEach(itemId => {
                const item = customItems[itemId];
                const itemElement = document.createElement('div');
                itemElement.className = 'custom-item';
                itemElement.innerHTML = `
                    <div class="item-info">
                        <div class="item-emoji">${item.emoji}</div>
                        <div class="item-details">
                            <div class="item-name">${item.name}</div>
                            <div class="item-price">${item.basePrice} ${item.baseCurrency}</div>
                        </div>
                    </div>
                    <div class="item-actions">
                        <button class="item-btn edit-btn" onclick="editCustomItem('${itemId}')">编辑</button>
                        <button class="item-btn delete-btn" onclick="deleteCustomItem('${itemId}')">删除</button>
                    </div>
                `;
                container.appendChild(itemElement);
            });
        }
        
        // 模态框控制
        function openCustomModal() {
            document.getElementById('customModal').style.display = 'block';
            loadCustomItems();
        }
        
        function closeCustomModal() {
            document.getElementById('customModal').style.display = 'none';
            cancelEdit();
        }
        
        // 动态更新所有select选项
        function updateAllSelectOptions() {
            for (let i = 1; i <= 6; i++) {
                updateSelectOptions(`currency${i}`);
            }
        }
        
        function updateSelectOptions(selectId) {
            const select = document.getElementById(selectId);
            if (!select) return;
            
            const currentValue = select.value;
            
            // 构建新的选项HTML
            let optionsHTML = '';
            
            // 加密货币
            optionsHTML += '<optgroup label="加密货币">';
            optionsHTML += '<option value="BTC">🟠 BTC</option>';
            optionsHTML += '<option value="ETH">♦️ ETH</option>';
            optionsHTML += '<option value="SOL">🟣 SOL</option>';
            optionsHTML += '<option value="BNB">🟡 BNB</option>';
            optionsHTML += '<option value="OKB">⚫ OKB</option>';
            optionsHTML += '</optgroup>';
            
            // 法币
            optionsHTML += '<optgroup label="法币">';
            optionsHTML += '<option value="USD">🇺🇸 USD</option>';
            optionsHTML += '<option value="CNY">🇨🇳 CNY</option>';
            optionsHTML += '<option value="JPY">🇯🇵 JPY</option>';
            optionsHTML += '<option value="KRW">🇰🇷 KRW</option>';
            optionsHTML += '<option value="SGD">🇸🇬 SGD</option>';
            optionsHTML += '<option value="AED">🇦🇪 AED</option>';
            optionsHTML += '<option value="HKD">🇭🇰 HKD</option>';
            optionsHTML += '<option value="MYR">🇲🇾 MYR</option>';
            optionsHTML += '</optgroup>';
            
            // 实物
            optionsHTML += '<optgroup label="实物">';
            optionsHTML += '<option value="ZHUJIAO">🍚 猪脚饭</option>';
            optionsHTML += '<option value="KFC">🍗 KFC</option>';
            optionsHTML += '<option value="IN11">💃 in11嫩模</option>';
            optionsHTML += '<option value="IPHONE17">📱 iPhone17</option>';
            optionsHTML += '<option value="MACBOOK">💻 MacBook Air</option>';
            optionsHTML += '<option value="ROLEX">⌚ Rolex</option>';
            optionsHTML += '<option value="XIAOMISU7">🏎️ Xiaomi Su7</option>';
            optionsHTML += '<option value="PORSCHE">🏎️ Porsche 718</option>';
            optionsHTML += '<option value="FERRARI">🏎️ Ferrari Roma</option>';
            optionsHTML += '</optgroup>';
            
            // 自定义项目
            if (Object.keys(customItems).length > 0) {
                optionsHTML += '<optgroup label="自定义">';
                Object.keys(customItems).forEach(itemId => {
                    const item = customItems[itemId];
                    optionsHTML += `<option value="${itemId}">${item.emoji} ${item.name}</option>`;
                });
                optionsHTML += '</optgroup>';
            }
            
            select.innerHTML = optionsHTML;
            
            // 恢复之前的选择值，如果该值仍然存在的话
            if (currentValue && select.querySelector(`option[value="${currentValue}"]`)) {
                select.value = currentValue;
            }
        }
        
        // 获取真实汇率
        async function loadRates() {
            try {
                // 确保自定义项目已加载
                const saved = localStorage.getItem('customItems');
                if (saved) {
                    try {
                        customItems = JSON.parse(saved);
                    } catch (error) {
                        console.error('加载自定义项目失败:', error);
                        customItems = {};
                    }
                }
                // 获取加密货币价格 (USD)
                const cryptoResponse = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum,solana,binancecoin,okb&vs_currencies=usd');
                const cryptoData = await cryptoResponse.json();
                
                // 获取法币汇率 (USD基准)
                const fiatResponse = await fetch('https://api.exchangerate-api.com/v4/latest/USD');
                const fiatData = await fiatResponse.json();
                
                const btcPrice = cryptoData.bitcoin.usd;
                const ethPrice = cryptoData.ethereum.usd;
                const solPrice = cryptoData.solana.usd;
                const bnbPrice = cryptoData.binancecoin.usd;
                const okbPrice = cryptoData.okb.usd;
                
                const currencies = ['CNY', 'JPY', 'KRW', 'SGD', 'AED', 'HKD', 'MYR'];
                const cryptos = ['BTC', 'ETH', 'SOL', 'BNB', 'OKB'];
                const products = ['ZHUJIAO', 'KFC', 'IN11', 'IPHONE17', 'FERRARI', 'PORSCHE', 'XIAOMISU7', 'ROLEX', 'MACBOOK'];
                const customItemIds = Object.keys(customItems);
                
                const cryptoPrices = { BTC: btcPrice, ETH: ethPrice, SOL: solPrice, BNB: bnbPrice, OKB: okbPrice };
                const productPrices = { 
                    ZHUJIAO: 20 / fiatData.rates.CNY,       // 20 CNY 转换为 USD
                    KFC: 50 / fiatData.rates.CNY,           // 50 CNY 转换为 USD
                    IN11: 3000 / fiatData.rates.CNY,        // 3000 CNY 转换为 USD
                    IPHONE17: 799,                          // 799 USD
                    FERRARI: 1750000 / fiatData.rates.CNY,  // 1,750,000 CNY 转换为 USD
                    PORSCHE: 550000 / fiatData.rates.CNY,   // 550,000 CNY 转换为 USD
                    XIAOMISU7: 215900 / fiatData.rates.CNY, // 215,900 CNY 转换为 USD
                    ROLEX: 56500 / fiatData.rates.CNY,      // 56,500 CNY 转换为 USD
                    MACBOOK: 999                            // 999 USD
                };
                
                // 计算自定义项目的USD价格
                const customPrices = {};
                Object.keys(customItems).forEach(itemId => {
                    const item = customItems[itemId];
                    if (item.baseCurrency === 'USD') {
                        customPrices[itemId] = item.basePrice;
                    } else if (fiatData.rates[item.baseCurrency]) {
                        customPrices[itemId] = item.basePrice / fiatData.rates[item.baseCurrency];
                    } else {
                        customPrices[itemId] = item.basePrice / 7.1; // 默认按CNY计算
                    }
                });
                
                rates = {};
                
                // 构建汇率矩阵
                const allCurrencies = [...cryptos, 'USD', ...currencies, ...products, ...customItemIds];
                allCurrencies.forEach(from => {
                    rates[from] = {};
                    allCurrencies.forEach(to => {
                        if (from === to) {
                            rates[from][to] = 1;
                        } else if (cryptos.includes(from) && cryptos.includes(to)) {
                            // 加密货币之间
                            rates[from][to] = cryptoPrices[from] / cryptoPrices[to];
                        } else if (cryptos.includes(from) && to === 'USD') {
                            // 加密货币到美元
                            rates[from][to] = cryptoPrices[from];
                        } else if (from === 'USD' && cryptos.includes(to)) {
                            // 美元到加密货币
                            rates[from][to] = 1 / cryptoPrices[to];
                        } else if (cryptos.includes(from) && currencies.includes(to)) {
                            // 加密货币到其他法币
                            rates[from][to] = cryptoPrices[from] * fiatData.rates[to];
                        } else if (currencies.includes(from) && cryptos.includes(to)) {
                            // 其他法币到加密货币
                            rates[from][to] = 1 / (cryptoPrices[to] * fiatData.rates[from]);
                        } else if (from === 'USD' && currencies.includes(to)) {
                            // 美元到其他法币
                            rates[from][to] = fiatData.rates[to];
                        } else if (currencies.includes(from) && to === 'USD') {
                            // 其他法币到美元
                            rates[from][to] = 1 / fiatData.rates[from];
                        } else if (currencies.includes(from) && currencies.includes(to)) {
                            // 法币之间
                            rates[from][to] = fiatData.rates[to] / fiatData.rates[from];
                        } else if (products.includes(from) && to === 'USD') {
                            // 产品到美元 (1 iPhone17 = 799 USD)
                            rates[from][to] = productPrices[from];
                        } else if (from === 'USD' && products.includes(to)) {
                            // 美元到产品 (1 USD = 1/799 iPhone17)
                            rates[from][to] = 1 / productPrices[to];
                        } else if (products.includes(from) && currencies.includes(to)) {
                            // 产品到其他法币
                            rates[from][to] = productPrices[from] * fiatData.rates[to];
                        } else if (currencies.includes(from) && products.includes(to)) {
                            // 其他法币到产品
                            rates[from][to] = 1 / (productPrices[to] * fiatData.rates[from]);
                        } else if (cryptos.includes(from) && products.includes(to)) {
                            // 加密货币到产品
                            rates[from][to] = cryptoPrices[from] / productPrices[to];
                        } else if (products.includes(from) && cryptos.includes(to)) {
                            // 产品到加密货币
                            rates[from][to] = productPrices[from] / cryptoPrices[to];
                        } else if (products.includes(from) && products.includes(to)) {
                            // 产品之间
                            rates[from][to] = productPrices[from] / productPrices[to];
                        } else if (customItemIds.includes(from) && to === 'USD') {
                            // 自定义项目到美元
                            rates[from][to] = customPrices[from];
                        } else if (from === 'USD' && customItemIds.includes(to)) {
                            // 美元到自定义项目
                            rates[from][to] = 1 / customPrices[to];
                        } else if (customItemIds.includes(from) && currencies.includes(to)) {
                            // 自定义项目到其他法币
                            rates[from][to] = customPrices[from] * fiatData.rates[to];
                        } else if (currencies.includes(from) && customItemIds.includes(to)) {
                            // 其他法币到自定义项目
                            rates[from][to] = 1 / (customPrices[to] * fiatData.rates[from]);
                        } else if (cryptos.includes(from) && customItemIds.includes(to)) {
                            // 加密货币到自定义项目
                            rates[from][to] = cryptoPrices[from] / customPrices[to];
                        } else if (customItemIds.includes(from) && cryptos.includes(to)) {
                            // 自定义项目到加密货币
                            rates[from][to] = customPrices[from] / cryptoPrices[to];
                        } else if (products.includes(from) && customItemIds.includes(to)) {
                            // 固定产品到自定义项目
                            rates[from][to] = productPrices[from] / customPrices[to];
                        } else if (customItemIds.includes(from) && products.includes(to)) {
                            // 自定义项目到固定产品
                            rates[from][to] = customPrices[from] / productPrices[to];
                        } else if (customItemIds.includes(from) && customItemIds.includes(to)) {
                            // 自定义项目之间
                            rates[from][to] = customPrices[from] / customPrices[to];
                        }
                    });
                });
                
                console.log('汇率加载成功:', rates);
            } catch (error) {
                console.error('汇率加载失败:', error);
                
                // 确保在备用汇率情况下也加载自定义项目
                const saved = localStorage.getItem('customItems');
                if (saved) {
                    try {
                        customItems = JSON.parse(saved);
                    } catch (error) {
                        console.error('加载自定义项目失败:', error);
                        customItems = {};
                    }
                }
                
                // 使用备用汇率
                rates = {
                    BTC: { USD: 65000, ETH: 24.5, SOL: 300, BNB: 100, OKB: 1444, CNY: 460000, JPY: 9500000, KRW: 87000000, SGD: 87000, AED: 240000, HKD: 507000, MYR: 280000, ZHUJIAO: 23000, KFC: 9200, IN11: 153.3, IPHONE17: 81.35, FERRARI: 0.26, PORSCHE: 0.83, XIAOMISU7: 2.13, ROLEX: 8.15, MACBOOK: 65.07 },
                    ETH: { USD: 2650, BTC: 0.041, SOL: 12, BNB: 4.1, OKB: 58.9, CNY: 18800, JPY: 390000, KRW: 3550000, SGD: 3550, AED: 9750, HKD: 20670, MYR: 11400, ZHUJIAO: 940, KFC: 376, IN11: 6.27, IPHONE17: 3.32, FERRARI: 0.011, PORSCHE: 0.034, XIAOMISU7: 0.087, ROLEX: 0.33, MACBOOK: 2.65 },
                    SOL: { USD: 220, BTC: 0.0034, ETH: 0.083, BNB: 0.34, OKB: 4.89, CNY: 1560, JPY: 32400, KRW: 295000, SGD: 295, AED: 810, HKD: 1716, MYR: 950, ZHUJIAO: 78, KFC: 31.2, IN11: 0.52, IPHONE17: 0.275, FERRARI: 0.00089, PORSCHE: 0.0028, XIAOMISU7: 0.0072, ROLEX: 0.0276, MACBOOK: 0.22 },
                    BNB: { USD: 650, BTC: 0.01, ETH: 0.245, SOL: 2.95, OKB: 14.4, CNY: 4600, JPY: 95700, KRW: 872000, SGD: 872, AED: 2390, HKD: 5070, MYR: 2800, ZHUJIAO: 230, KFC: 92, IN11: 1.53, IPHONE17: 0.814, FERRARI: 0.0026, PORSCHE: 0.0084, XIAOMISU7: 0.021, ROLEX: 0.082, MACBOOK: 0.65 },
                    OKB: { USD: 45, BTC: 0.00069, ETH: 0.017, SOL: 0.204, BNB: 0.069, CNY: 319.5, JPY: 6615, KRW: 60300, SGD: 60.3, AED: 165.15, HKD: 351, MYR: 193.5, ZHUJIAO: 15.97, KFC: 6.39, IN11: 0.106, IPHONE17: 0.056, FERRARI: 0.00018, PORSCHE: 0.00058, XIAOMISU7: 0.0015, ROLEX: 0.0057, MACBOOK: 0.045 },
                    USD: { BTC: 0.0000154, ETH: 0.00038, SOL: 0.0045, BNB: 0.0015, OKB: 0.022, CNY: 7.1, JPY: 147, KRW: 1340, SGD: 1.34, AED: 3.67, HKD: 7.8, MYR: 4.3, ZHUJIAO: 0.35, KFC: 0.14, IN11: 0.0024, IPHONE17: 0.00125, FERRARI: 0.0000041, PORSCHE: 0.000013, XIAOMISU7: 0.000033, ROLEX: 0.000126, MACBOOK: 0.001 },
                    CNY: { USD: 0.141, BTC: 0.00000217, ETH: 0.000053, SOL: 0.00064, BNB: 0.00022, OKB: 0.0031, JPY: 20.7, KRW: 189, SGD: 0.189, AED: 0.52, HKD: 1.1, MYR: 0.61, ZHUJIAO: 0.05, KFC: 0.02, IN11: 0.00033, IPHONE17: 0.000176, FERRARI: 0.00000057, PORSCHE: 0.0000018, XIAOMISU7: 0.0000046, ROLEX: 0.0000177, MACBOOK: 0.000141 },
                    HKD: { USD: 0.128, BTC: 0.00000197, ETH: 0.0000484, SOL: 0.000583, BNB: 0.0002, OKB: 0.0028, CNY: 0.91, JPY: 18.8, KRW: 172, SGD: 0.172, AED: 0.47, MYR: 0.55, ZHUJIAO: 0.046, KFC: 0.018, IN11: 0.0003, IPHONE17: 0.00016, FERRARI: 0.00000052, PORSCHE: 0.0000016, XIAOMISU7: 0.0000042, ROLEX: 0.0000161, MACBOOK: 0.000128 },
                    JPY: { USD: 0.0068, BTC: 0.000000105, ETH: 0.0000026, SOL: 0.000031, BNB: 0.0000104, CNY: 0.048, KRW: 9.1, SGD: 0.009, AED: 0.025, HKD: 0.053, MYR: 0.029, ZHUJIAO: 0.0024, KFC: 0.00096, IN11: 0.000016, IPHONE17: 0.0000085, FERRARI: 0.000000028, PORSCHE: 0.000000087, XIAOMISU7: 0.00000022, ROLEX: 0.00000085, MACBOOK: 0.0000068 },
                    MYR: { USD: 0.23, BTC: 0.0000036, ETH: 0.000088, SOL: 0.00105, BNB: 0.00036, CNY: 1.64, JPY: 34.2, KRW: 308, SGD: 0.31, AED: 0.85, HKD: 1.8, ZHUJIAO: 0.082, KFC: 0.033, IN11: 0.00055, IPHONE17: 0.000287, FERRARI: 0.00000094, PORSCHE: 0.00000296, XIAOMISU7: 0.0000076, ROLEX: 0.0000289, MACBOOK: 0.00023 },
                    SGD: { USD: 0.745, BTC: 0.0000115, ETH: 0.00028, SOL: 0.0034, BNB: 0.0011, CNY: 5.29, JPY: 110, KRW: 1000, AED: 2.74, HKD: 5.82, MYR: 3.2, ZHUJIAO: 0.26, KFC: 0.105, IN11: 0.00175, IPHONE17: 0.000931, FERRARI: 0.000003, PORSCHE: 0.0000096, XIAOMISU7: 0.000025, ROLEX: 0.0000937, MACBOOK: 0.000745 },
                    AED: { USD: 0.272, BTC: 0.0000042, ETH: 0.0001, SOL: 0.00123, BNB: 0.00042, CNY: 1.93, JPY: 40, KRW: 364, SGD: 0.36, HKD: 2.12, MYR: 1.17, ZHUJIAO: 0.099, KFC: 0.0385, IN11: 0.00064, IPHONE17: 0.00034, FERRARI: 0.0000011, PORSCHE: 0.000035, XIAOMISU7: 0.000089, ROLEX: 0.000342, MACBOOK: 0.000272 },
                    KRW: { USD: 0.00075, BTC: 0.0000000115, ETH: 0.00000028, SOL: 0.0000034, BNB: 0.00000115, CNY: 0.0053, JPY: 0.11, SGD: 0.001, AED: 0.0028, HKD: 0.0058, MYR: 0.0032, ZHUJIAO: 0.000378, KFC: 0.0001512, IN11: 0.0000025, IPHONE17: 0.00000094, FERRARI: 0.00000000031, PORSCHE: 0.00000000096, XIAOMISU7: 0.0000000025, ROLEX: 0.0000000094, MACBOOK: 0.00000075 },
                    ZHUJIAO: { USD: 2.82, BTC: 0.0000434, ETH: 0.00106, SOL: 0.0128, BNB: 0.00434, CNY: 20, JPY: 414, KRW: 3774, SGD: 3.78, AED: 10.35, HKD: 22, MYR: 12.1, KFC: 0.4, IN11: 0.0067, IPHONE17: 0.0035, FERRARI: 0.0000114, PORSCHE: 0.0000364, XIAOMISU7: 0.0000926, ROLEX: 0.00035, MACBOOK: 0.0028 },
                    KFC: { USD: 7.04, BTC: 0.000108, ETH: 0.00266, SOL: 0.032, BNB: 0.0108, CNY: 50, JPY: 1036, KRW: 9436, SGD: 9.44, AED: 25.88, HKD: 55, MYR: 30.3, ZHUJIAO: 2.5, IN11: 0.0167, IPHONE17: 0.0088, FERRARI: 0.0000286, PORSCHE: 0.0000909, XIAOMISU7: 0.000232, ROLEX: 0.00088, MACBOOK: 0.007 },
                    IN11: { USD: 422.5, BTC: 0.0065, ETH: 0.1594, SOL: 1.92, BNB: 0.65, CNY: 3000, JPY: 62125, KRW: 566000, SGD: 566.15, AED: 1551.5, HKD: 3297, MYR: 1816.75, ZHUJIAO: 150, KFC: 60, IPHONE17: 0.529, FERRARI: 0.00171, PORSCHE: 0.00545, XIAOMISU7: 0.0139, ROLEX: 0.053, MACBOOK: 0.423 },
                    IPHONE17: { USD: 799, BTC: 0.0123, ETH: 0.3017, SOL: 3.63, BNB: 1.23, CNY: 5673, JPY: 117453, KRW: 1070000, SGD: 1071, AED: 2932, HKD: 6232, MYR: 3436, ZHUJIAO: 284, KFC: 113.6, IN11: 1.89, FERRARI: 0.0036, PORSCHE: 0.0115, XIAOMISU7: 0.0297, ROLEX: 0.10, MACBOOK: 0.8 },
                    FERRARI: { USD: 246479, BTC: 3.79, ETH: 93, SOL: 1120, BNB: 379, CNY: 1750000, JPY: 36232353, KRW: 330000000, SGD: 330564, AED: 905237, HKD: 1923538, MYR: 1059859, ZHUJIAO: 87500, KFC: 35000, IN11: 583.3, IPHONE17: 308.5, PORSCHE: 3.18, XIAOMISU7: 8.11, ROLEX: 30.97, MACBOOK: 246.73 },
                    PORSCHE: { USD: 77465, BTC: 1.19, ETH: 29.2, SOL: 352, BNB: 119, CNY: 550000, JPY: 11389706, KRW: 103800000, SGD: 103922, AED: 284638, HKD: 604227, MYR: 333100, ZHUJIAO: 27500, KFC: 11000, IN11: 183.3, IPHONE17: 97, FERRARI: 0.314, XIAOMISU7: 2.55, ROLEX: 9.73, MACBOOK: 77.5 },
                    XIAOMISU7: { USD: 30408, BTC: 0.468, ETH: 11.47, SOL: 138.2, BNB: 46.8, CNY: 215900, JPY: 4470016, KRW: 40760000, SGD: 40767, AED: 111699, HKD: 237182, MYR: 130757, ZHUJIAO: 10795, KFC: 4318, IN11: 71.97, IPHONE17: 38.1, FERRARI: 0.123, PORSCHE: 0.393, ROLEX: 3.82, MACBOOK: 30.44 },
                    ROLEX: { USD: 7958, BTC: 0.122, ETH: 3.00, SOL: 36.17, BNB: 12.24, CNY: 56500, JPY: 1170026, KRW: 10660000, SGD: 10668, AED: 29229, HKD: 62072, MYR: 34220, ZHUJIAO: 2825, KFC: 1130, IN11: 18.83, IPHONE17: 9.96, FERRARI: 0.032, PORSCHE: 0.103, XIAOMISU7: 0.262, MACBOOK: 7.97 },
                    MACBOOK: { USD: 999, BTC: 0.0154, ETH: 0.377, SOL: 4.54, BNB: 1.54, CNY: 7092, JPY: 146853, KRW: 1338000, SGD: 1339, AED: 3667, HKD: 7792, MYR: 4297, ZHUJIAO: 355, KFC: 142, IN11: 2.36, IPHONE17: 1.25, FERRARI: 0.0041, PORSCHE: 0.013, XIAOMISU7: 0.033, ROLEX: 0.126 }
                };
                
                // 即使在备用汇率情况下，也要处理自定义项目
                if (Object.keys(customItems).length > 0) {
                    const customItemIds = Object.keys(customItems);
                    const allCurrencies = ['BTC', 'ETH', 'SOL', 'BNB', 'OKB', 'USD', 'CNY', 'JPY', 'KRW', 'SGD', 'AED', 'HKD', 'MYR', 'ZHUJIAO', 'KFC', 'IN11', 'IPHONE17', 'FERRARI', 'PORSCHE', 'XIAOMISU7', 'ROLEX', 'MACBOOK', ...customItemIds];
                    
                    // 计算自定义项目的USD价格
                    const customPrices = {};
                    Object.keys(customItems).forEach(itemId => {
                        const item = customItems[itemId];
                        if (item.baseCurrency === 'USD') {
                            customPrices[itemId] = item.basePrice;
                        } else {
                            customPrices[itemId] = item.basePrice / 7.1; // 使用固定CNY汇率
                        }
                    });
                    
                    // 为每个自定义项目添加汇率
                    customItemIds.forEach(customId => {
                        if (!rates[customId]) rates[customId] = {};
                        
                        allCurrencies.forEach(currency => {
                            if (customId === currency) {
                                rates[customId][currency] = 1;
                            } else if (rates[currency]) {
                                if (currency === 'USD') {
                                    rates[customId][currency] = customPrices[customId];
                                    rates[currency][customId] = 1 / customPrices[customId];
                                } else if (rates[currency]['USD']) {
                                    rates[customId][currency] = customPrices[customId] / rates[currency]['USD'];
                                    rates[currency][customId] = rates[currency]['USD'] / customPrices[customId];
                                }
                            }
                        });
                        
                        // 自定义项目之间的汇率
                        customItemIds.forEach(otherId => {
                            if (customId !== otherId) {
                                rates[customId][otherId] = customPrices[customId] / customPrices[otherId];
                            }
                        });
                    });
                }
            }
            
            // 确保汇率加载后更新所有select选项
            if (typeof updateAllSelectOptions === 'function') {
                updateAllSelectOptions();
            }
        }
        
        
        // 保存状态到本地存储
        function saveState() {
            const state = {};
            for (let i = 1; i <= 6; i++) {
                state[`amount${i}`] = document.getElementById(`amount${i}`).value;
                state[`currency${i}`] = document.getElementById(`currency${i}`).value;
            }
            state.lastInputField = lastInputField; // 保存最后输入的栏位
            localStorage.setItem('valueConverterState', JSON.stringify(state));
        }
        
        // 从本地存储恢复状态
        function restoreState() {
            // 首先加载自定义项目
            loadCustomItems();
            
            // 更新所有select选项以包含自定义项目
            updateAllSelectOptions();
            
            const savedState = localStorage.getItem('valueConverterState');
            if (savedState) {
                try {
                    const state = JSON.parse(savedState);
                    for (let i = 1; i <= 6; i++) {
                        if (state[`amount${i}`]) {
                            document.getElementById(`amount${i}`).value = state[`amount${i}`];
                        }
                        if (state[`currency${i}`]) {
                            const select = document.getElementById(`currency${i}`);
                            // 确保选项存在才设置值
                            if (select.querySelector(`option[value="${state[`currency${i}`]}"]`)) {
                                select.value = state[`currency${i}`];
                            }
                        }
                    }
                    // 恢复最后输入的栏位
                    if (state.lastInputField) {
                        lastInputField = state.lastInputField;
                    }
                    console.log('状态已恢复:', state);
                } catch (error) {
                    console.log('恢复状态失败:', error);
                }
            }
        }
        
        function convert(sourceIndex) {
            if (updating) return;
            updating = true;
            
            const sourceAmount = document.getElementById(`amount${sourceIndex}`).value.replace(/,/g, '');
            const sourceCurrency = document.getElementById(`currency${sourceIndex}`).value;
            
            if (!sourceAmount || sourceAmount === '') {
                for (let i = 1; i <= 6; i++) {
                    if (i !== sourceIndex) {
                        document.getElementById(`amount${i}`).value = '';
                    }
                }
                updating = false;
                return;
            }
            
            const amount = parseFloat(sourceAmount);
            if (isNaN(amount)) {
                updating = false;
                return;
            }
            
            for (let i = 1; i <= 6; i++) {
                if (i !== sourceIndex) {
                    const targetCurrency = document.getElementById(`currency${i}`).value;
                    let result;
                    
                    if (sourceCurrency === targetCurrency) {
                        result = amount;
                    } else if (rates[sourceCurrency] && rates[sourceCurrency][targetCurrency]) {
                        result = amount * rates[sourceCurrency][targetCurrency];
                    } else {
                        result = 0;
                    }
                    
                    document.getElementById(`amount${i}`).value = result.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
                }
            }
            
            updating = false;
        }
        
        // 初始化应用
        function initApp() {
            // 初始化emoji选择器
            initEmojiPicker();
            
            // 先恢复状态，再加载API
            restoreState();
            
            // 添加事件监听器
            setupEventListeners();
            
            // 页面加载时获取汇率，加载完成后重新计算
            loadRates().then(() => {
                // API加载完成后，如果有数据就重新计算一次以获得最新汇率
                const hasData = Array.from({length: 6}, (_, i) => i + 1).some(i => 
                    document.getElementById(`amount${i}`).value.trim() !== ''
                );
                if (hasData) {
                    // API加载完成后，以最后输入的栏位为基准重新计算
                    const lastAmount = document.getElementById(`amount${lastInputField}`).value.trim();
                    if (lastAmount !== '') {
                        console.log(`API加载完成，以栏位${lastInputField}为基准重新计算最新汇率`);
                        convert(lastInputField);
                    }
                }
            });
        }
        
        function setupEventListeners() {
            // 转换器输入框事件
            for (let i = 1; i <= 6; i++) {
                document.getElementById(`amount${i}`).addEventListener('input', () => {
                    lastInputField = i; // 更新最后输入的栏位
                    convert(i);
                    saveState(); // 保存状态
                });
                document.getElementById(`currency${i}`).addEventListener('change', () => {
                    // 货币选择变更时，以最后输入的栏位为基准重新计算
                    convert(lastInputField);
                    saveState(); // 保存状态
                });
            }
            
            // 管理自定义项目按钮
            document.getElementById('manageCustomBtn').addEventListener('click', openCustomModal);
            
            // 模态框关闭按钮
            document.querySelector('.close').addEventListener('click', closeCustomModal);
            document.querySelector('.emoji-close').addEventListener('click', closeEmojiModal);
            
            // 点击模态框背景关闭
            document.getElementById('customModal').addEventListener('click', (e) => {
                if (e.target === document.getElementById('customModal')) {
                    closeCustomModal();
                }
            });
            document.getElementById('emojiModal').addEventListener('click', (e) => {
                if (e.target === document.getElementById('emojiModal')) {
                    closeEmojiModal();
                }
            });
            
            // emoji选择器输入框
            document.getElementById('customEmoji').addEventListener('click', openEmojiModal);
            
            // 添加/更新自定义项目按钮
            document.getElementById('addCustomBtn').addEventListener('click', addCustomItem);
            
            // 取消编辑按钮
            document.getElementById('cancelEditBtn').addEventListener('click', cancelEdit);
            
            // 表单验证 - 阻止Enter键提交
            document.getElementById('customName').addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    addCustomItem();
                }
            });
            document.getElementById('customPrice').addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    addCustomItem();
                }
            });
        }
        
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', () => {
            initApp();
        });
        
    </script>
    </div>
</body>
</html>